describe('Testing smaller about pentest page', () => {
    beforeEach(() => {
        cy.visit('localhost:4200/about-pentests');
    })

    it('Should correctly load "About Pentest" page', () => {
        CheckBigNavbar();
        CheckContent();
        CheckFooterElements();
    })

    it('Should redirect to landing page', () => {
        LandingPageRedirect();
    })

    it('Redirect to order a pentest should be disabled', () => {
        cy.get('a.nav-link').contains('Order a pentest').should('not.be.enabled').and('be.visible');
    })
})

describe('Testing bigger about pentest page', () => {
    beforeEach(() => {
        cy.viewport(600, 800);
        cy.visit('localhost:4200/about-pentests');
    })

    it.only('Should correctly load "About Pentest" page', () => {
        CheckSmallNavbar();
        CheckContent();
        CheckFooterElements();
    })

    it('Should redirect to landing page', () => {
        cy.get('span.navbar-toggler-icon').click().then(() => {
            LandingPageRedirect();
        })
    })

    it('Redirect to order a pentest should be disabled', () => {
        cy.get('span.navbar-toggler-icon').should('exist').and('be.visible').and('not.be.disabled').click().then(() => {
            cy.get('a.nav-link').contains('Order a pentest').should('not.be.enabled').and('be.visible');
        })
    })
})

function CheckNavbarLinks() {
    cy.get('a.nav-link').contains('Home').should('be.visible').and('not.have.class', 'fw-bolder').
        and('not.have.class', 'active').and('not.be.disabled')
    cy.get('a.nav-link').contains('About pentest').should('be.visible').and('have.class', 'fw-bolder')
        .and('not.be.disabled').and('have.class', 'active');;
    cy.get('a.nav-link').contains('Order a pentest').should('be.visible').and('not.have.class', 'fw-bolder')
        .and('not.be.enabled').and('not.have.class', 'active');;
    cy.get('button').contains('Login').should('be.visible').and('not.be.disabled');
}

function NavbarLinksNotShown() {
    cy.get('a.nav-link').contains('Home').should('not.be.visible');
    cy.get('a.nav-link').contains('About pentest').should('not.be.visible');
    cy.get('a.nav-link').contains('Order a pentest').should('not.be.visible');
}

function CheckBigNavbar() {
    cy.get('img.img-fluid.col-3').should('exist').and('be.visible');
    cy.get('div.navbar-brand.pb-3').should('exist').and('be.visible').and('contain', 'Cybersecurity Assessment');
    CheckNavbarLinks();
}

function CheckSmallNavbar() {
    cy.get('img.img-fluid.col-3').should('exist').and('be.visible');
    cy.get('div.navbar-brand.pb-3').should('exist').and('be.visible').and('contain', 'Cybersecurity Assessment');
    NavbarLinksNotShown();
    cy.get('span.navbar-toggler-icon').should('exist').and('be.visible').and('not.be.disabled').click().then(() => {
        CheckNavbarLinks();
        cy.wait(300);
        cy.get('span.navbar-toggler-icon').click().then(() => {
            NavbarLinksNotShown();
        });
    })
    
}

function CheckContent() {
    cy.get('div.row.pt-4.mt-4').should('exist').and('be.visible');
    CheckChild('div.row.pt-4.mt-4', 0, 0, 'H2', 'What is pentest');
    CheckChild('div.row.pt-4.mt-4', 0, 1, 'P', '');
    CheckChild('div.row.pt-4.mt-4', 1, 0, 'H2', 'Types of Penetration Testing');
    CheckChild('div.row.pt-4.mt-4', 2, 0, 'TABLE', '');
    CheckChild('div.row.pt-4.mt-4', 3, 0, 'H2', 'Types of Penetration Testing methods');
    CheckChild('div.row.pt-4.mt-4', 4, 0, 'TABLE', '');
    CheckChild('div.row.pt-4.mt-4', 5, 0, 'H2', 'Trust and Certification');
    CheckChild('div.row.pt-4.mt-4', 5, 1, 'P', '');
}

function CheckChild(parent, containerNumber, childNumber, tagName, containString) {
    cy.get(parent).children().eq(containerNumber).then($container => {
        cy.get($container).children().eq(childNumber).then($child => {
            if (containString === '') {
                expect($child).to.have.prop('tagName', tagName);
            } else {
                expect($child).to.have.prop('tagName', tagName).and.to.contain(containString);
            }
        })
    })
}

function CheckFooterLink(divNumber, linkNumber, text) {
    cy.get('div.col.col-xs-12.col-sm-6.col-md-4.col-lg-3.col-xl-3').eq(divNumber).children().children().eq(linkNumber).should($child => {
        expect($child).to.have.prop('tagName', 'LI').and.to.have.id('link_title').and.to.contain(text);
    });
}

function CheckFooterAElement(linkNumber, text) {
    cy.get('p#footer_more_info').children().eq(linkNumber).should($child => {
        expect($child).to.have.prop('tagName', 'A').and.to.have.class('footer-link').and.to.contain(text);
    })
}

function CheckFooterElements() {
    cy.get('footer.bg-dark.text-light.py-4').should('exist').and('be.visible');
    cy.get('div.container.pt-5').should('exist').and('be.visible');
    cy.get('div.col.col-xs-12.col-sm-6.col-md-4.col-lg-3.col-xl-3').should('exist').and('have.length', 6).and('be.visible');

    cy.get('h5#section_title').contains('Products & Services').should('exist').and('be.visible');
    cy.get('h5#section_title').contains('Support & Documentation').should('exist').and('be.visible');
    cy.get('h5#section_title').contains('Insights').should('exist').and('be.visible');
    cy.get('h5#section_title').contains('About Us').should('exist').and('be.visible');
    cy.get('h5#connect_section_title').contains('Connect').should('exist').and('be.visible');
    cy.get('h5#newsletter_section_title').contains('Newsletter').should('exist').and('be.visible');

    CheckFooterLink(0, 0, 'Value Partnerships & Consulting');
    CheckFooterLink(0, 1, 'Medical Imaging');
    CheckFooterLink(0, 2, 'Laboratory Diagnostics');
    CheckFooterLink(0, 3, 'Point of Care Testing');
    CheckFooterLink(0, 4, 'Digital Solutions & Automation');
    CheckFooterLink(0, 5, 'Services');
    CheckFooterLink(0, 6, 'Healthcare IT');
    CheckFooterLink(0, 7, 'Clinical Specialities & Diseases');

    CheckFooterLink(1, 0, 'Document Library (SDS, IFU, etc.)');
    CheckFooterLink(1, 1, 'Education & Training');
    CheckFooterLink(1, 2, 'PEPconnect');
    CheckFooterLink(1, 3, 'Teamplay Fleet');
    CheckFooterLink(1, 4, 'Webshop');
    CheckFooterLink(1, 5, 'Online Services');

    CheckFooterLink(2, 0, 'Innovating Personalized Care');
    CheckFooterLink(2, 1, 'Achieving Operational Excellence');
    CheckFooterLink(2, 2, 'Transforming the System of Care');
    CheckFooterLink(2, 3, 'Insights Center');

    CheckFooterLink(3, 0, 'About Siemens Healthineers');
    CheckFooterLink(3, 1, 'Compliance');
    CheckFooterLink(3, 2, 'Conferences & Events');
    CheckFooterLink(3, 3, 'Contact Us');
    CheckFooterLink(3, 4, 'Investor Relations');
    CheckFooterLink(3, 5, 'Job Search');
    CheckFooterLink(3, 6, 'Perspectives');
    CheckFooterLink(3, 7, 'Press Center');

    cy.get('ul.list-unstyled.horizontal-group-icon').should('exist').and('be.visible');
    cy.get('i.footer-icon.bi-twitter').should('exist').and('be.visible');
    cy.get('i.footer-icon.bi-facebook').should('exist').and('be.visible');
    cy.get('i.footer-icon.bi-instagram').should('exist').and('be.visible');
    cy.get('i.footer-icon.bi-linkedin').should('exist').and('be.visible');
    cy.get('i.footer-icon.bi-youtube').should('exist').and('be.visible');

    cy.get('button.btn-primary.m-1').contains('Subscribe').should('exist').and('be.enabled').and('be.visible');
    cy.get('p#footer_more_info').should('exist').and('be.visible');
}

function LandingPageRedirect() {
    cy.get('a.nav-link').contains('Home').click().then(() => {
        cy.url().should('include', 'welcome');
        cy.get('a.nav-link').contains('Home').should('have.class', 'active').and('have.class', 'fw-bolder');
        cy.get('a.nav-link').contains('About pentest').should('not.have.class', 'active').and('not.have.class', 'fw-bolder');
    })
}